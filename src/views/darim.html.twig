{% extends "base.html.twig" %}
{% block title %}DARim{% endblock %}
{% block body %}
<!-- BEGIN CONTAINER -->
<div class="page-container">
    <div class="page-content-wrapper">
        <div class="page-content" style="min-height:940px">
            <div class="container-fluid">
                <div class="row">
                    <div class="col-md-1">
                    </div>
                    <div class="col-md-10" id="addActivity">
                        {% include "addActivity.html.twig" %}
                    </div>
                    <div class="col-md-1">
                    </div>
                </div>
            </div>
            <div class="container-fluid">
                <div class="row">
                    <div class="col-md-1">
                    </div>
                    <div class="col-md-10" id="diary">
                        {% include "listActivities.html.twig" %}
                    </div>
                    <div class="col-md-1">
                    </div>
                </div>
            </div>
            <div class="container-fluid">
                <div class="row">
                    <div class="col-md-1">
                    </div>
                    <div class="col-md-7" id="listActivity">
                        {% include "listTodos.html.twig" %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
{% block javascripts %}
    <script src="public/js/jquery.clipboard.js" type="text/javascript"></script>
    <script src="public/js/darim.js" type="text/javascript" ></script>
    <script src="public/js/ActivityEdition.js" type="text/javascript" ></script>
    <script>
        $(document).ready(function() {
            $('.selectpicker').selectpicker();
            $('button#copy').clipboard({
                    path: 'public/js/jquery.clipboard.swf',
                    copy: function() {
                        console.log('DAR copied. Paste it now!');
                        var dar = 'Ajourd\'hui \n';
                        var darObjects = {};
                        darObjects['clients'] = {};
                        $('.dailyRow').each(function(index, obj) {
                            var clientName = $(obj).find('.activityClientName').text().trim();
                            var task = $(obj).find('.activityTask').text().trim();
                            var comment = $(obj).find('.activityComment').text().trim();
                            if(!darObjects.hasOwnProperty(clientName)){
                                darObjects['clients'][clientName] = {};
                                darObjects['clients'][clientName]['tasks'] = {};
                            }
                            if(!darObjects['clients'][clientName].hasOwnProperty('tasks')){
                                darObjects['clients'][clientName]['tasks'][task] = {};
                                if(!darObjects['clients'][clientName]['tasks'][task].hasOwnProperty('comment')){
                                    darObjects['clients'][clientName]['tasks'][task]['comment'] = comment;
                                }else{
                                    darObjects['clients'][clientName]['tasks'][task]['comment'] += '\n\t\t' +comment;
                                }
                            }else{
                                darObjects['clients'][clientName]['tasks'] = {};
                                darObjects['clients'][clientName]['tasks'][task] = {};
                                darObjects['clients'][clientName]['tasks'][task]['comment'] = comment;
                            }

                        });
                        for (var client in darObjects['clients']) {
                            dar += client + ' \n';
                            console.log(client);
                            for (var tasks in client['tasks']) {
                                for (var task in tasks) {
                                    dar += '\t*' +task;
                                    dar += task['comment']+' \n';
                                };
                            };
                        };

                        console.log(darObjects);
                        dar += '\nDemain \n';
                        $('.todoRow').each(function(index, obj) {
                            dar += $(obj).find('.todoRow_client_name').text().trim() + ' \n';
                            dar += '    *' +$(obj).find('.todoRow_task').text().trim();
                            dar += '/' +$(obj).find('.todoRow_comment').text().trim() + ' \n';
                        });
                        return dar;
                    }
            });
            $('#admin').click(function(){
                window.location.href = "/DARim/admin";
            })
        });
    </script>
{% endblock %}